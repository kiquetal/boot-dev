# I want to create a deployment for cluster k8s using nginx but defining a custom http page
# using the declarative approach

# Create a deployment
```yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
    # 3 replicas
    replicas: 3
    # selector
    selector:
        matchLabels:
        app: nginx
    # template for the pods
    template:
        metadata:
        labels:
            app: nginx
        spec:
        containers:
        - name: nginx
            image: nginx:1.14.2
            ports:
            - containerPort: 80
            volumeMounts:
            - mountPath: /usr/share/nginx/html
            name: html
        volumes:
        - name: html
            configMap:
            name: nginx-configmap
            items:
            - key: index.html
                path: index.html
```

# Show the needed steps to create a OIDC On AWS for gitlab
Create a new IAM role for the OIDC provider
```bash
aws iam create-role --role-name oidc-gitlab --assume-role-policy-document file://trust-policy.json
```
Create a new OIDC provider
```bash
aws iam create-open-id-connect-provider --url https://gitlab.com --thumbprint-list 9e99a48a9960b14926bb7f3b02e22da2b0ab7280 --client-id-list sts.amazonaws.com --region us-east-1
```
Attach the IAM role to the OIDC provider
```bash
aws iam attach-role-policy --role-name oidc-gitlab --policy-arn arn:aws:iam::aws:policy/AWSLoadBalancerControllerIAMPolicy
```
Create a new IAM policy for the OIDC provider
```bash
aws iam create-policy --policy-name oidc-gitlab --policy-document file://policy.json
```
Attach the IAM policy to the OIDC provider
```bash
aws iam attach-role-policy --role-name oidc-gitlab --policy-arn arn:aws:iam::aws:policy/oidc-gitlab
```
